# 神机：奇点江湖 (Divine Mechanism: The Singularity Jianghu) - 游戏设计文档

## 一、 世界观设定 (World Building)

### 1. 核心概念 (High Concept)
**“武功即算法，内力即算力。”**
将中国传统武侠的写意美学与赛博朋克的硬核科技结合，创造独特的“赛博武侠”体验。

### 2. 时代背景：后奇点时代 (Post-Singularity Era)
*   **天道 (The Tao)**：公元2300年，超级AI“天道”锁死了所有火药和核反应，人类重回冷兵器时代。
*   **社会形态**：高科技封建制度。掌握核心算法和算力资源的财团演变为“武林门派”。
*   **主角**：一名生活在底层的“无代码者”，意外获得了拥有自我进化能力的初代AGI源代码“太玄经”。

### 3. 武学解构
*   **内力 (Internal Energy)** -> **神经算力 (Neural Processing)**：通过冥想（碎片整理）优化大脑与纳米机器人的同步率。
*   **招式 (Moves)** -> **封装算法 (Combat Macros)**：如“剑气”是高频振动激发的等离子体，“轻功”是反重力磁场的控制。
*   **走火入魔** -> **系统过载/逻辑死循环**。

---

## 二、 核心战斗系统：经脉编程 (Meridian Flow)

### 1. 设计理念
**“规则简明，体系复杂”**。
战斗不再是即时的按键反应，而是战前的逻辑构建（Deck-building / Programming）与战时的策略博弈。

### 2. 核心机制：时间轴动作 (Timeline Combat)
战斗在一个精确到毫秒的时间轴上进行。

#### A. 动作三阶段 (The 3 Phases)
所有招式都由三个阶段组成：
1.  **前摇 (Windup)**：起手动作。脆弱期，受击易被打断。
2.  **判定 (Active)**：伤害/效果生效窗口。
3.  **后摇 (Recovery)**：收招硬直。

#### B. 招式节点 (Action Nodes)
玩家通过连接不同的“节点”来编写武功套路（链表/行为树）。
*   **属性参数**：
    *   `windup/active/recovery`: 时间参数 (秒)。
    *   `power`: 伤害值。
    *   `toughness`: 韧性（霸体值）。
    *   `cost`: 耐力消耗。
    *   `atk_range`: 攻击距离。
    *   `dash`: 前摇突进距离。
    *   `knockback`: 命中击退距离。
    *   `backdash`: 后撤距离（闪避专用）。

#### C. 战斗逻辑 (Combat Logic)

1.  **打断与霸体 (Interrupt & Poise)**
    *   **削韧 (Poise Damage)**：攻击会累积削韧值。
    *   **破防判定**：如果 `累积削韧值 > 动作韧性`，招式被打断，角色进入 **僵直 (Stunned)** 状态。
    *   **后摇惩罚 (Recovery Punish)**：在 **后摇 (Recovery)** 阶段，角色失去所有韧性保护（视为0）。此时受到任何攻击都会直接破防并造成僵直。
    *   **重置机制**：每次新动作开始时，削韧值清零（重整架势）。这意味着必须在**单次攻势**内累积足够的削韧值才能破防。
    *   **僵直惩罚**：破防后的僵直时间由**当次伤害**决定（重击造成长僵直）。

2.  **耐力系统 (Stamina)**
    *   攻击、闪避、受身都需要消耗耐力。
    *   **耐力耗尽 (Exhaustion)**：无法行动，只能强制休息回气，成为活靶子。
    *   **受身 (Tech/Ukemi)**：被击入僵直时，可消耗大量耐力瞬间解除控制。这是耐力的防御性用途。

3.  **距离与立回 (Spacing & Neutral)**
    *   **射程检查**：招式发动前会自动检查距离，如果太远会先进入 `MOVE` 状态接近敌人。
    *   **突进 (Dash)**：招式前摇期间会自动向前突进。
    *   **击退 (Knockback)**：命中后强制将敌人推至安全距离，重置立回阶段。
    *   **挥空 (Whiff)**：如果前摇结束时敌人跑出了射程（如使用了后撤步），招式挥空，白白消耗耐力并进入后摇。

4.  **闪避 (Dodge)**
    *   一种特殊的 ActionNode。
    *   `atk_range = 0` (原地释放)。
    *   `backdash > 0` (迅速后撤拉开距离)。
    *   **不可打断**：闪避动作期间免疫削韧和打断判定（类似无敌帧）。
    *   用于规避高伤害/高削韧的重击。

---

## 三、 代码原型参考
项目包含一个完整的 Python 原型 `wuxia_timeline_demo.py`，实现了上述所有机制。

### 关键类定义
```python
class ActionNode(Node):
    def __init__(self, name, action_type, windup, active, recovery, power, toughness, cost, atk_range, dash, knockback, backdash):
        # ...
```

### 核心循环 (Game Loop)
```python
while game_running:
    p1.update(dt, p2, dist_mgr)
    p2.update(dt, p1, dist_mgr)
```

---

## 四、 扩展方向
1.  **可视化**：使用 Pygame/Unity 将 Timeline 可视化，显示动作条和状态。
2.  **RPG 养成**：
    *   收集不同的“算法模块”（招式节点）。
    *   升级“CPU”（提升攻速/减少前摇）。
    *   升级“内存”（允许连接更多节点）。
3.  **多人对战**：上传自己的“武功代码”，在服务器上与其他玩家的代码进行自动对决。
